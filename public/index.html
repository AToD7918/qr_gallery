<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>메뉴</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bottom-ui: 0px; /* JS에서 갱신 */
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
      background: #1a1a1a;
      overflow: hidden;
      height: 100dvh;  /* 100vh → 100dvh */
      width: 100vw;
    }
    
    .container {
      position: relative;
      width: 100%;
      height: 100dvh; /* 100vh → 100dvh */
      display: flex;
      flex-direction: column;
      background: #1a1a1a;
    }
    
    .slider-container {
      flex: 1;
      position: relative;
      overflow: hidden;
      background: #1a1a1a;
      height: 100dvh; /* 100vh → 100dvh */
    }
    
    .slider {
      display: flex;
      height: 100%;
      transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      align-items: flex-start; /* 가용 높이 상단 기준 정렬 */
    }

    .slider.zoomed {
      transition: none;
    }
    
    .slide {
      min-width: 100%;
      height: calc(100dvh - var(--bottom-ui)); /* 하단 UI 제외한 가용 높이 */
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      position: relative;
    }

    .image-wrapper {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    .image-wrapper.zoom-mode {
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      cursor: grab;
      display: block;
      align-items: unset;
      justify-content: unset;
      padding: 80px 20px 120px 20px;
    }

    .image-wrapper.zoom-mode:active {
      cursor: grabbing;
    }
    
    .slide img {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: width 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                  height 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      display: block;
      margin: 0;
    }

    .slide img.zoomed {
      border-radius: 0;
      max-width: none;
      max-height: none;
      margin: 0;
    }
    
    .controls {
      position: fixed;
      bottom: env(safe-area-inset-bottom, 20px);
      left: 0;
      right: 0;
      padding: 20px;
      padding-bottom: calc(20px + env(safe-area-inset-bottom, 0px));
      background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 5;
    }
    
    .nav-btn {
      background: rgba(255, 255, 255, 0.95);
      border: none;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      transition: all 0.2s;
      color: #333;
      font-weight: bold;
    }
    
    .nav-btn:active {
      transform: scale(0.95);
      background: rgba(255, 255, 255, 1);
    }
    
    .nav-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    
    .counter {
      background: rgba(255, 255, 255, 0.95);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      color: #333;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .dots {
      position: fixed;
      bottom: calc(80px + env(safe-area-inset-bottom, 0px));
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      z-index: 5;
    }
    
    .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      transition: all 0.3s;
    }
    
    .dot.active {
      background: #fff;
      width: 24px;
      border-radius: 4px;
    }

    @media (max-width: 480px) {
      .slide {
        padding: 10px;
      }
      
      .nav-btn {
        width: 44px;
        height: 44px;
      }
      
      .controls {
        padding-bottom: calc(15px + env(safe-area-inset-bottom, 0px));
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="slider-container">
      <div class="slider" id="slider"></div>
      
      <div class="dots" id="dots"></div>
      
      <div class="controls">
        <button class="nav-btn" id="prevBtn">◀</button>
        <div class="counter" id="counter"></div>
        <button class="nav-btn" id="nextBtn">▶</button>
      </div>
    </div>
  </div>

  <script>
    const images = [
      'img/photo.jpg',
      'img/photo1.jpg',
      'img/photo2.jpg',
      'img/photo3.jpg'
    ];

    let currentIndex = 0;
    const slider = document.getElementById('slider');
    const dots = document.getElementById('dots');
    const counter = document.getElementById('counter');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    // 하단 UI(controls + dots) 높이만큼 CSS 변수 갱신
    function updateBottomUI() {
      const controlsEl = document.querySelector('.controls');
      const controlsH = controlsEl ? controlsEl.offsetHeight : 0;

      // 값을 줄이면 이미지가 내려감.
      const dotsOffset = 20;
      const reserved = controlsH + dotsOffset;

      document.documentElement.style.setProperty('--bottom-ui', reserved + 'px');
    }

    // 슬라이드 생성
    images.forEach((src, index) => {
      const slide = document.createElement('div');
      slide.className = 'slide';
      
      const wrapper = document.createElement('div');
      wrapper.className = 'image-wrapper';
      
      const img = document.createElement('img');
      img.src = src;
      img.alt = `메뉴 ${index + 1}`;
      img.loading = index === 0 ? 'eager' : 'lazy';
      
      // 이미지 확대/축소 기능
      let isZoomed = false;
      let imgNaturalWidth = 0;
      let imgNaturalHeight = 0;
      let imgDisplayWidth = 0;
      let imgDisplayHeight = 0;

      // 이미지 로드 완료 시 크기 저장
      img.addEventListener('load', () => {
        imgNaturalWidth = img.naturalWidth;
        imgNaturalHeight = img.naturalHeight;
        updateDisplaySize();
      });

      function updateDisplaySize() {
        if (!isZoomed) {
          const rect = img.getBoundingClientRect();
          imgDisplayWidth = rect.width;
          imgDisplayHeight = rect.height;
        }
      }

      // 더블탭으로 확대/축소
      let lastTap = 0;
      let tapTimeout = null;

      wrapper.addEventListener('touchend', (e) => {
        const currentTime = new Date().getTime();
        const tapLength = currentTime - lastTap;
        
        if (tapLength < 300 && tapLength > 0) {
          e.preventDefault();
          clearTimeout(tapTimeout);
          
          if (!isZoomed) {
            // 확대
            const touch = e.changedTouches[0];
            const wrapperRect = wrapper.getBoundingClientRect();
            const imgRect = img.getBoundingClientRect();
            
            const touchX = touch.clientX - wrapperRect.left;
            const touchY = touch.clientY - wrapperRect.top;
            const imgTouchX = touch.clientX - imgRect.left;
            const imgTouchY = touch.clientY - imgRect.top;
            
            const currentWidth = imgRect.width;
            const currentHeight = imgRect.height;
            
            const scale = 2;
            const newWidth = currentWidth * scale;
            const newHeight = currentHeight * scale;
            
            isZoomed = true;
            img.classList.add('zoomed');
            wrapper.classList.add('zoom-mode');
            slider.classList.add('zoomed');
            
            img.style.width = newWidth + 'px';
            img.style.height = newHeight + 'px';
            
            requestAnimationFrame(() => {
              const scrollX = (imgTouchX * scale) - touchX + 20; // 좌측 패딩 보정
              const scrollY = (imgTouchY * scale) - touchY + 80; // 상단 패딩 보정
              
              wrapper.scrollLeft = scrollX;
              wrapper.scrollTop = scrollY;
            });
            
          } else {
            // 축소
            isZoomed = false;
            img.classList.remove('zoomed');
            wrapper.classList.remove('zoom-mode');
            slider.classList.remove('zoomed');
            
            img.style.width = '';
            img.style.height = '';
            
            wrapper.scrollLeft = 0;
            wrapper.scrollTop = 0;
          }
        }
        
        lastTap = currentTime;
      }, { passive: false });

      wrapper.appendChild(img);
      slide.appendChild(wrapper);
      slider.appendChild(slide);

      // 도트 생성
      const dot = document.createElement('div');
      dot.className = 'dot';
      if (index === 0) dot.classList.add('active');
      dots.appendChild(dot);
    });

    function updateSlider() {
      slider.style.transform = `translateX(-${currentIndex * 100}%)`;
      counter.textContent = `${currentIndex + 1} / ${images.length}`;
      
      // 도트 업데이트
      document.querySelectorAll('.dot').forEach((dot, index) => {
        dot.classList.toggle('active', index === currentIndex);
      });

      // 버튼 상태 업데이트
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === images.length - 1;
    }

    prevBtn.addEventListener('click', () => {
      if (currentIndex > 0) {
        currentIndex--;
        updateSlider();
      }
    });

    nextBtn.addEventListener('click', () => {
      if (currentIndex < images.length - 1) {
        currentIndex++;
        updateSlider();
      }
    });

    // 터치 스와이프 기능
    let touchStartX = 0;
    let touchEndX = 0;
    let isSwiping = false;

    slider.addEventListener('touchstart', (e) => {
      // 확대된 상태에서는 스와이프 비활성화
      if (slider.classList.contains('zoomed')) return;
      
      touchStartX = e.changedTouches[0].screenX;
      isSwiping = true;
    }, { passive: true });

    slider.addEventListener('touchmove', (e) => {
      if (!isSwiping || slider.classList.contains('zoomed')) return;
    }, { passive: true });

    slider.addEventListener('touchend', (e) => {
      // 확대된 상태에서는 스와이프 비활성화
      if (slider.classList.contains('zoomed')) return;
      if (!isSwiping) return;
      
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
      isSwiping = false;
    }, { passive: true });

    function handleSwipe() {
      const swipeThreshold = 50;
      const diff = touchStartX - touchEndX;

      if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0 && currentIndex < images.length - 1) {
          // 왼쪽 스와이프 (다음)
          currentIndex++;
          updateSlider();
        } else if (diff < 0 && currentIndex > 0) {
          // 오른쪽 스와이프 (이전)
          currentIndex--;
          updateSlider();
        }
      }
    }

    // 키보드 네비게이션
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft' && currentIndex > 0) {
        currentIndex--;
        updateSlider();
      } else if (e.key === 'ArrowRight' && currentIndex < images.length - 1) {
        currentIndex++;
        updateSlider();
      }
    });

    // 리사이즈·회전 시 하단 UI 재계산
    window.addEventListener('load', updateBottomUI);
    window.addEventListener('resize', updateBottomUI);
    window.addEventListener('orientationchange', updateBottomUI);

    // 초기화
    updateSlider();
    updateBottomUI(); // 하단 UI 보정값 적용
  </script>
</body>
</html>
